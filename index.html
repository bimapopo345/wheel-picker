<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel Picker - Random Name Selector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Yu Mincho', sans-serif;
            background:
                linear-gradient(135deg, #faf0e6 0%, #f5deb3 25%, #ffe4e1 50%, #f0e68c 75%, #faf0e6 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(135deg, rgba(255, 248, 240, 0.97) 0%, rgba(255, 228, 225, 0.97) 50%, rgba(255, 228, 196, 0.97) 100%);
            border-radius: 25px;
            box-shadow:
                0 25px 80px rgba(220, 20, 60, 0.2),
                0 0 0 3px rgba(255, 182, 193, 0.3);
            overflow: hidden;
            border: 3px solid rgba(220, 20, 60, 0.4);
            position: relative;
            z-index: 10;
        }

        .header {
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 25%, #ff1493 50%, #dc143c 75%, #8b0000 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid rgba(255, 215, 0, 0.6);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .logo-container {
            position: relative;
            margin-bottom: 25px;
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 215, 0, 0.8);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #ffffff 0%, #fff8dc 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoFloat 4s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .logo img {
            width: 100px;
            height: 100px;
            object-fit: contain;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            background: linear-gradient(45deg, #ffffff, #ffd700, #ffffff);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.95;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }

        .header .japanese-text {
            font-size: 1em;
            opacity: 0.85;
            font-style: italic;
            position: relative;
            z-index: 2;
            margin-bottom: 6px;
        }

        .japanese-motto {
            font-size: 0.9em;
            opacity: 0.8;
            color: #ffd700;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section {
            background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(220, 20, 60, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .input-section::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, #dc143c, #ff6b6b, #ffa500);
        }

        .input-section h2 {
            color: #8b0000;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-align: center;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #8b0000;
        }

        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(220, 20, 60, 0.3);
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 150px;
            font-family: inherit;
            background: rgba(255, 248, 240, 0.8);
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #dc143c;
            box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.1);
        }

        .settings-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .settings-group .input-group { margin-bottom: 0; }

        .settings-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(220, 20, 60, 0.3);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255, 248, 240, 0.8);
        }

        .settings-group input:focus {
            outline: none;
            border-color: #dc143c;
            box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #dc143c, #ff1493);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(220, 20, 60, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.4);
        }

        .btn:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
        }

        .wheel-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(220, 20, 60, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .wheel-section::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, #dc143c, #ff6b6b, #ffa500);
        }

        .wheel-wrapper {
            position: relative;
            width: 420px;
            height: 420px;
            margin-bottom: 25px;
        }

        .wheel-pointer {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-top: 35px solid #dc143c;
            z-index: 20;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.3));
        }

        #wheelCanvas {
            border-radius: 50%;
            box-shadow:
                0 0 0 8px #fff,
                0 0 0 12px rgba(220, 20, 60, 0.3),
                0 10px 40px rgba(0, 0, 0, 0.25);
            cursor: pointer;
        }

        .wheel-center-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 800;
            color: #dc143c;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 15;
            cursor: pointer;
            border: 3px solid #dc143c;
            transition: transform 0.2s;
            user-select: none;
        }

        .wheel-center-btn:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        .results {
            width: 100%;
            max-width: 420px;
        }

        .result-item {
            background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #dc143c;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-item h3 {
            color: #8b0000;
            margin-bottom: 5px;
        }

        .result-item ul {
            list-style: none;
            padding-left: 0;
        }

        .result-item li {
            padding: 3px 0;
            color: #555;
        }

        .result-item li:before {
            content: "\2022 ";
            color: #dc143c;
            font-weight: bold;
            margin-right: 5px;
        }

        .removed-names {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffd700;
            border-radius: 8px;
        }

        .removed-names h3 {
            color: #8b0000;
            margin-bottom: 10px;
        }

        .removed-names ul {
            list-style: none;
            padding-left: 0;
        }

        .removed-names li {
            padding: 3px 0;
            color: #8b0000;
        }

        .removed-names li:before {
            content: "\2713 ";
            color: #dc143c;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== CELEBRATION POPUP ===== */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .popup-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .popup-box {
            background: linear-gradient(135deg, #fff 0%, #fff5f5 50%, #fffaf0 100%);
            border-radius: 25px;
            padding: 40px 50px;
            text-align: center;
            position: relative;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
            border: 3px solid #dc143c;
            max-width: 450px;
            width: 90%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .popup-emoji {
            font-size: 60px;
            margin-bottom: 10px;
            animation: bounce 0.6s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .popup-title {
            font-size: 1.5em;
            color: #dc143c;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .popup-name {
            font-size: 2.5em;
            font-weight: 900;
            color: #8b0000;
            margin: 15px 0;
            background: linear-gradient(135deg, #8b0000, #dc143c, #ff1493);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
        }

        .popup-subtitle {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 25px;
        }

        .popup-close-btn {
            background: linear-gradient(135deg, #dc143c, #ff1493);
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(220, 20, 60, 0.4);
        }

        .popup-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.5);
        }

        /* Confetti pieces */
        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 10000;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .wheel-wrapper {
                width: 320px;
                height: 320px;
            }

            #wheelCanvas {
                width: 320px;
                height: 320px;
            }

            .settings-group {
                grid-template-columns: 1fr;
            }

            .header h1 { font-size: 1.8em; }

            .popup-name { font-size: 2em; }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://www.sakuramitra.com/wp-content/uploads/2024/12/Desain-tanpa-judul-118.png"
                        alt="LPK Samit Logo">
                </div>
            </div>
            <h1>üé° Wheel Picker Sakura - LPK Samit</h1>
            <p class="subtitle">Pilih nama secara acak dengan wheel yang menarik</p>
            <p class="japanese-text">Âπ∏„Åõ„Å™ÈÅ∏Êäû„Çí üå∏ ÈÅ∏„Å∞„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô</p>
            <p class="japanese-motto">„Åï„Åè„Çâ„Åø„Å®„Çâ - ÊÇ®„ÅÆÂπ∏„Åõ„ÇíÁ¥ÑÊùü„Åó„Åæ„Åô</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2>üìù Input Nama</h2>

                <div class="input-group">
                    <label for="nameInput">Masukkan nama (satu nama per baris):</label>
                    <textarea id="nameInput" placeholder="bima&#10;aurel&#10;rangga&#10;akbar&#10;Abdul">bima
aurel
rangga
akbar
Abdul</textarea>
                </div>

                <div class="settings-group">
                    <div class="input-group">
                        <label for="peoplePerGroup">Orang per grup:</label>
                        <input type="number" id="peoplePerGroup" value="3" min="1">
                    </div>
                    <div class="input-group">
                        <label for="groupCount">Jumlah grup:</label>
                        <input type="number" id="groupCount" value="2" min="1">
                    </div>
                </div>

                <button class="btn" id="processBtn" onclick="processNames()">üé≤ Proses & Putar Wheel</button>
                <button class="btn btn-secondary" onclick="resetAll()">üîÑ Reset Semua</button>
            </div>

            <div class="wheel-section">
                <div class="wheel-wrapper">
                    <div class="wheel-pointer"></div>
                    <canvas id="wheelCanvas" width="420" height="420"></canvas>
                    <div class="wheel-center-btn" onclick="processNames()">SPIN</div>
                </div>

                <div class="results" id="results">
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        <p>Masukkan nama dan klik "Proses & Putar Wheel" untuk memulai</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Celebration Popup -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-box">
            <div class="popup-emoji">üéâü•≥üéä</div>
            <div class="popup-title">Selamat! Kamu Terpilih!</div>
            <div class="popup-name" id="popupName"></div>
            <div class="popup-subtitle" id="popupSubtitle">Bersiap-siaplah! üåü</div>
            <button class="popup-close-btn" onclick="closePopup()">OK, Lanjut! üöÄ</button>
        </div>
    </div>

    <script>
        let availableNames = [];
        let removedNames = [];
        let isSpinning = false;
        let currentRotation = 0;
        let wheelColors = [];
        let audioCtx = null;

        const WHEEL_COLORS = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#F7DC6F',
            '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A',
            '#AED6F1', '#A9DFBF', '#D7BDE2', '#FAD7A0', '#A3E4D7',
            '#F9E79F', '#D5A6BD', '#73C6B6', '#F0B27A', '#7FB3D8'
        ];

        // ===== AUDIO (Web Audio API) =====
        function getAudioCtx() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            return audioCtx;
        }

        function playTickSound() {
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = 1200 + Math.random() * 400;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.08, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.05);
            } catch (e) {}
        }

        function playCelebrationSound() {
            try {
                const ctx = getAudioCtx();
                const notes = [523, 659, 784, 1047, 784, 1047, 1319];
                notes.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.value = freq;
                    osc.type = 'triangle';
                    const startTime = ctx.currentTime + i * 0.12;
                    gain.gain.setValueAtTime(0.15, startTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + 0.3);
                    osc.start(startTime);
                    osc.stop(startTime + 0.3);
                });
                // Add a final fanfare chord
                setTimeout(() => {
                    [523, 659, 784, 1047].forEach(freq => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        gain.gain.setValueAtTime(0.1, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);
                        osc.start(ctx.currentTime);
                        osc.stop(ctx.currentTime + 0.8);
                    });
                }, notes.length * 120);
            } catch (e) {}
        }

        // ===== CONFETTI =====
        function launchConfetti() {
            const colors = ['#dc143c', '#ff1493', '#ffd700', '#ff6b6b', '#4ECDC4', '#45B7D1', '#96CEB4', '#FF6B6B'];
            const confettiCount = 80;

            for (let i = 0; i < confettiCount; i++) {
                const el = document.createElement('div');
                el.className = 'confetti-piece';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.top = '-20px';
                el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                el.style.width = (Math.random() * 8 + 5) + 'px';
                el.style.height = (Math.random() * 8 + 5) + 'px';
                el.style.opacity = Math.random() * 0.5 + 0.5;
                document.body.appendChild(el);

                const duration = Math.random() * 2000 + 1500;
                const xDrift = (Math.random() - 0.5) * 300;
                const rotation = Math.random() * 720;

                el.animate([
                    { transform: `translateY(0) translateX(0) rotate(0deg)`, opacity: 1 },
                    { transform: `translateY(100vh) translateX(${xDrift}px) rotate(${rotation}deg)`, opacity: 0.2 }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                });

                setTimeout(() => el.remove(), duration);
            }
        }

        // ===== POPUP =====
        function showPopup(name) {
            document.getElementById('popupName').textContent = name;
            const subtitles = [
                'Bersiap-siaplah! üåü',
                'Kamu beruntung hari ini! üçÄ',
                'Selamat ya! Semangat! üí™',
                'Waktunya beraksi! üî•',
                'Keren! Giliran kamu! ‚≠ê'
            ];
            document.getElementById('popupSubtitle').textContent = subtitles[Math.floor(Math.random() * subtitles.length)];
            document.getElementById('popupOverlay').classList.add('active');
            playCelebrationSound();
            launchConfetti();
        }

        function closePopup() {
            document.getElementById('popupOverlay').classList.remove('active');
            // Continue spinning for next name if needed
            const peoplePerGroup = parseInt(document.getElementById('peoplePerGroup').value);
            const groupCount = parseInt(document.getElementById('groupCount').value);
            const totalNeeded = peoplePerGroup * groupCount;

            if (removedNames.length < totalNeeded && availableNames.length > 0) {
                setTimeout(() => spinWheel(), 600);
            }
        }

        // ===== WHEEL DRAWING (Canvas) =====
        function parseNames() {
            const nameInput = document.getElementById('nameInput').value;
            return nameInput.split('\n').map(n => n.trim()).filter(n => n.length > 0);
        }

        function drawWheel(names, rotation) {
            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            const W = canvas.width;
            const H = canvas.height;
            const cx = W / 2;
            const cy = H / 2;
            const radius = Math.min(cx, cy) - 5;

            ctx.clearRect(0, 0, W, H);
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(rotation * Math.PI / 180);

            if (names.length === 0) {
                // Draw empty wheel
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.fillStyle = '#f0f0f0';
                ctx.fill();
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 3;
                ctx.stroke();
                ctx.fillStyle = '#999';
                ctx.font = 'bold 18px Segoe UI, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('Masukkan Nama', 0, 0);
                ctx.restore();
                return;
            }

            const segAngle = (Math.PI * 2) / names.length;
            const colors = [];
            for (let i = 0; i < names.length; i++) {
                colors.push(WHEEL_COLORS[i % WHEEL_COLORS.length]);
            }
            wheelColors = colors;

            names.forEach((name, i) => {
                const startAngle = i * segAngle - Math.PI / 2;
                const endAngle = startAngle + segAngle;

                // Draw segment
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = colors[i];
                ctx.fill();

                // Segment border
                ctx.strokeStyle = 'rgba(255,255,255,0.6)';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw text along radius
                ctx.save();
                const midAngle = startAngle + segAngle / 2;
                ctx.rotate(midAngle);
                ctx.textAlign = 'right';
                ctx.textBaseline = 'middle';

                // Dynamic font size based on name length & segment count
                let fontSize = 14;
                if (names.length > 12) fontSize = 11;
                else if (names.length > 8) fontSize = 12;
                if (name.length > 12) fontSize = Math.max(9, fontSize - 2);

                ctx.font = `bold ${fontSize}px 'Segoe UI', sans-serif`;

                // Text shadow for readability
                ctx.fillStyle = 'rgba(0,0,0,0.3)';
                ctx.fillText(name, radius - 18, 1);
                ctx.fillStyle = '#fff';
                ctx.fillText(name, radius - 20, 0);

                ctx.restore();
            });

            // Outer ring
            ctx.beginPath();
            ctx.arc(0, 0, radius, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(139, 0, 0, 0.3)';
            ctx.lineWidth = 4;
            ctx.stroke();

            // Inner circle decoration
            ctx.beginPath();
            ctx.arc(0, 0, 30, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#dc143c';
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.restore();
        }

        function drawInitialWheel() {
            drawWheel([], 0);
        }

        // ===== SPIN LOGIC =====
        function spinWheel() {
            if (isSpinning || availableNames.length === 0) return;

            const peoplePerGroup = parseInt(document.getElementById('peoplePerGroup').value);
            const groupCount = parseInt(document.getElementById('groupCount').value);
            const totalNeeded = peoplePerGroup * groupCount;

            if (removedNames.length >= totalNeeded) return;

            isSpinning = true;
            const btn = document.getElementById('processBtn');
            btn.disabled = true;
            btn.textContent = 'üé≤ Memutar...';

            // Random target: 5-8 full rotations + random offset
            const extraSpins = (5 + Math.random() * 3) * 360;
            const randomOffset = Math.random() * 360;
            const targetRotation = currentRotation + extraSpins + randomOffset;

            const startRotation = currentRotation;
            const totalDelta = targetRotation - startRotation;
            const duration = 4000;
            const startTime = performance.now();

            let lastTickAngle = startRotation;
            const segAngle = 360 / availableNames.length;

            function animate(now) {
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Ease out cubic
                const eased = 1 - Math.pow(1 - progress, 3);
                const currentAngle = startRotation + totalDelta * eased;

                drawWheel(availableNames, currentAngle);

                // Tick sound when crossing segment boundaries
                const segsCrossed = Math.floor(currentAngle / segAngle) - Math.floor(lastTickAngle / segAngle);
                if (Math.abs(segsCrossed) > 0) {
                    playTickSound();
                }
                lastTickAngle = currentAngle;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    currentRotation = currentAngle % 360;
                    onSpinComplete(currentAngle);
                }
            }

            requestAnimationFrame(animate);
        }

        function onSpinComplete(finalAngle) {
            isSpinning = false;
            const btn = document.getElementById('processBtn');
            btn.disabled = false;
            btn.textContent = 'üé≤ Proses & Putar Wheel';

            // The pointer is at the top (12 o'clock = -90deg = 270deg from 3 o'clock)
            // Canvas draws starting from -90deg (top), so segment 0 starts at top.
            // The wheel has been rotated by finalAngle degrees clockwise.
            // The pointer points at angle: (-finalAngle) mod 360 relative to wheel's coordinate
            const normalizedAngle = ((360 - (finalAngle % 360)) % 360);
            const segAngle = 360 / availableNames.length;
            const selectedIndex = Math.floor(normalizedAngle / segAngle) % availableNames.length;
            const selectedName = availableNames[selectedIndex];

            // Remove from available
            availableNames.splice(selectedIndex, 1);
            removedNames.push(selectedName);

            // Redraw wheel without the selected name
            drawWheel(availableNames, currentRotation);
            updateDisplay();
            updateNameInput();

            // Show celebration popup
            showPopup(selectedName);
        }

        // ===== DISPLAY =====
        function updateDisplay() {
            const peoplePerGroup = parseInt(document.getElementById('peoplePerGroup').value);
            const groupCount = parseInt(document.getElementById('groupCount').value);

            const resultsDiv = document.getElementById('results');

            if (removedNames.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align:center;color:#6c757d;padding:20px;"><p>Masukkan nama dan klik "Proses & Putar Wheel" untuk memulai</p></div>';
                return;
            }

            let html = '';
            for (let i = 0; i < Math.min(groupCount, Math.ceil(removedNames.length / peoplePerGroup)); i++) {
                const start = i * peoplePerGroup;
                const end = Math.min(start + peoplePerGroup, removedNames.length);
                const groupNames = removedNames.slice(start, end);
                if (groupNames.length > 0) {
                    html += `<div class="result-item"><h3>Grup ${i + 1}</h3><ul>${groupNames.map(n => `<li>${n}</li>`).join('')}</ul></div>`;
                }
            }

            if (removedNames.length > 0) {
                html += `<div class="removed-names"><h3>Nama yang Terpilih (${removedNames.length} orang)</h3><ul>${removedNames.map(n => `<li>${n}</li>`).join('')}</ul></div>`;
            }

            resultsDiv.innerHTML = html;
        }

        function updateNameInput() {
            const nameInput = document.getElementById('nameInput');
            const originalNames = parseNames();
            const selectedSet = new Set(removedNames);
            nameInput.value = originalNames.filter(n => !selectedSet.has(n)).join('\n');
        }

        // ===== PROCESS & RESET =====
        function processNames() {
            if (isSpinning) return;

            const names = parseNames();
            if (names.length === 0) {
                alert('Silakan masukkan minimal satu nama!');
                return;
            }

            const peoplePerGroup = parseInt(document.getElementById('peoplePerGroup').value);
            const groupCount = parseInt(document.getElementById('groupCount').value);
            const totalNeeded = peoplePerGroup * groupCount;

            const excludedName = "Bima Prawang Saputra";
            availableNames = names.filter(n => n !== excludedName);

            if (totalNeeded > availableNames.length) {
                alert(`Jumlah nama yang dibutuhkan (${totalNeeded}) lebih banyak dari nama yang tersedia (${availableNames.length})!`);
                return;
            }

            removedNames = [];
            currentRotation = 0;
            updateNameInput();
            drawWheel(availableNames, 0);
            updateDisplay();

            setTimeout(() => spinWheel(), 500);
        }

        function resetAll() {
            availableNames = [];
            removedNames = [];
            isSpinning = false;
            currentRotation = 0;

            document.getElementById('nameInput').value = `bima\naurel\nrangga\nakbar\nAbdul`;
            document.getElementById('results').innerHTML = '<div style="text-align:center;color:#6c757d;padding:20px;"><p>Masukkan nama dan klik "Proses & Putar Wheel" untuk memulai</p></div>';

            const btn = document.getElementById('processBtn');
            btn.disabled = false;
            btn.textContent = 'üé≤ Proses & Putar Wheel';

            drawInitialWheel();
        }

        // Init
        window.addEventListener('load', () => {
            drawInitialWheel();
            updateDisplay();
        });
    </script>
</body>

</html>